<p-menubar [model]="items">
  <ng-template #end>
    <div class="flex flex-row gap-x-2">
      @if (isSignedIn()) {
      <p-popover #op>
        <ng-template #content>
          <button
            type="button"
            class="text-md p-3 rounded-lg transition-all duration-300 hover:bg-white/20 hover:backdrop-blur-md hover:shadow-lg cursor-pointer"
            (click)="onAddListing()"
            data-testid="add-listing-action"
          >
            Add listing
          </button>
        </ng-template>
      </p-popover>
      <button
        pButton
        type="button"
        (click)="op.toggle($event)"
        data-testid="add-listing-menu-button"
      >
        <span class="pi pi-plus"></span>
      </button>
      } @if (isSignedIn()) {
      <button (click)="onSignOut()" pButton label="Sign out" icon="pi pi-sign-out"></button>
      } @else {
      <a routerLink="/login">
        <button pButton label="Sign in" icon="pi pi-sign-in"></button>
      </a>
      }
    </div>
  </ng-template>
</p-menubar>
<p-dialog
  [(visible)]="showingDialog"
  header="Add a listing"
  [resizable]="false"
  [focusOnShow]="false"
  [modal]="true"
  [maximizable]="false"
  styleClass="w-full md:w-3/4 lg:w-2/3"
  contentStyleClass="max-h-none"
>
  @if(formGroup) {
  <form [formGroup]="formGroup" (ngSubmit)="onSubmit()">
    <div class="grid grid-cols-2 gap-4 mb-6">
      <div class="col-span-2">
        <label class="block text-sm font-semibold mb-2">Title</label>
        <input
          pInputText
          formControlName="title"
          placeholder="Title"
          class="w-full"
          data-testid="add-listing-title"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold mb-2">Location</label>
        <input
          pInputText
          formControlName="location"
          placeholder="Location"
          class="w-full"
          data-testid="add-listing-location"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold mb-2">Street</label>
        <input
          pInputText
          formControlName="street"
          placeholder="Street"
          class="w-full"
          data-testid="add-listing-street"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold mb-2">Price</label>
        <input
          pInputText
          formControlName="price"
          placeholder="Price"
          type="number"
          class="w-full"
          data-testid="add-listing-price"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold mb-2">Area (mÂ²)</label>
        <input
          pInputText
          formControlName="area"
          placeholder="Area"
          type="number"
          class="w-full"
          data-testid="add-listing-area"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold mb-2">Floor</label>
        <input
          pInputText
          formControlName="floor"
          placeholder="Floor"
          class="w-full"
          data-testid="add-listing-floor"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold mb-2">Number of Floors</label>
        <input
          pInputText
          formControlName="num_of_floors"
          placeholder="Number of floors"
          class="w-full"
          data-testid="add-listing-num-of-floors"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold mb-2">Year Built</label>
        <p-datepicker
          data-testid="add-listing-build-year"
          view="year"
          dateFormat="yy"
          formControlName="build_year"
          [autofocus]="false"
          showIcon
          class="w-full"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold mb-2">Property Type</label>
        <p-select
          formControlName="property_type"
          [options]="propertyOptions"
          placeholder="Property type"
          [autofocus]="false"
          class="w-full"
          data-testid="add-listing-property-type"
        ></p-select>
      </div>

      <div>
        <label class="block text-sm font-semibold mb-2">Transaction Type</label>
        <p-select
          formControlName="transaction_type"
          [options]="transactionOptions"
          placeholder="Transaction type"
          [autofocus]="false"
          class="w-full"
          data-testid="add-listing-transaction-type"
        ></p-select>
      </div>

      <div class="flex justify-center items-center">
        <p-fileupload
          #fu
          name="demo[]"
          [multiple]="true"
          mode="basic"
          accept="image/*"
          chooseIcon="pi pi-upload"
          [customUpload]="true"
          (uploadHandler)="onUpload($event)"
        >
        </p-fileupload>
      </div>

      <div class="col-span-2">
        <label class="block text-sm font-semibold mb-2">Description</label>
        <textarea
          formControlName="description"
          placeholder="Description"
          pTextarea
          rows="4"
          class="w-full"
          [autoResize]="true"
          data-testid="add-listing-description"
        ></textarea>
      </div>
    </div>

    <div class="flex justify-center gap-3 pt-4 border-t">
      <button type="submit" pButton label="Save" data-testid="add-listing-save"></button>
      <button
        type="button"
        pButton
        label="Cancel"
        (click)="onCancel()"
        severity="danger"
        data-testid="add-listing-cancel"
      ></button>
      <button type="reset" pButton label="Reset" severity="secondary"></button>
    </div>
  </form>
  }
</p-dialog>
